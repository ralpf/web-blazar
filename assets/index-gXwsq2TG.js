const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ColorArray-DdSo_VNh.js","assets/FormUnit-C-IcR_K4.js","assets/FlickerWave-Blx7cjny.js","assets/MoodColors-CzMyuSUP.js","assets/SlidersHSV-B3y4xx1e.js","assets/ColorItem-Zxn_6MR4.js","assets/InputUnit-DdMMWUWl.js","assets/Color-DjessYRo.js","assets/LampView-Ca5-L7fj.js","assets/ViewUnit-uQiRhdNi.js","assets/ButtonsRow-BmwUqoFJ.js","assets/ButtonsRowSig-QZSFIG-e.js","assets/Checkbox-DgTaWaXC.js","assets/Dropdown-TmdMK-gA.js","assets/Numeral-3jtf51H9.js","assets/Slider-B3-yrkMK.js"])))=>i.map(i=>d[i]);
!function polyfill(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(t);new MutationObserver(t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&processPreload(t)}).observe(document,{childList:!0,subtree:!0})}function processPreload(t){if(t.ep)return;t.ep=!0;const e=function getFetchOpts(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const t={},e=function preload(e,o,r){let s=Promise.resolve();if(o&&o.length>0){let allSettled=function(t){return Promise.all(t.map(t=>Promise.resolve(t).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))};document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=e?.nonce||e?.getAttribute("nonce");s=allSettled(o.map(e=>{if((e=function(t){return"https://ralpf.github.io/web-blazar/"+t}(e))in t)return;t[e]=!0;const o=e.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const i=document.createElement("link");return i.rel=o?"stylesheet":"modulepreload",o||(i.as="script"),i.crossOrigin="",i.href=e,r&&i.setAttribute("nonce",r),document.head.appendChild(i),o?new Promise((t,o)=>{i.addEventListener("load",t),i.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function handlePreloadError(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&handlePreloadError(e.reason);return e().catch(handlePreloadError)})},o=class _RequestDispatcher{static process(t){const e=this.transformUrl(t),o=this.formatQuerrySection(e),r=this.escapeUrl(this.removeHash(o)),s=`${this.baseUrl}${r}`;this.GET(s)}static transformUrl(t){return`/${t.split("/").filter(t=>t.length>0).map(t=>this.xfTable[t]??t).join("/")}`}static formatQuerrySection(t){const e=t.split("/"),o=e[e.length-1];let r=t;if(o&&o.includes("=")){const t=e.slice(0,-1).filter(t=>t.length>0).join("/");r=t.length>0?`/${t}?${o}`:`/?${o}`}return r}static removeHash(t){return t.replace(/#/g,"")}static escapeUrl(t){return t.includes("#")?t.split("#").join("%23"):t}static async GET(t){if(log(`GET -> ${t}`),t.includes("127.0.0.1")||t.includes("localhost"))return void log("Skipping request to localhost");const e=await fetch(t,{method:"GET"});e.ok||err(`ESP GET failed: ${e.status}`);log(`RESP <- ${await e.text()}`)}};o.baseUrl=`http://${window.location.host}`,o.xfTable={ViewsManager:"esp",LampView:"lamp",DeckView:"deck",SettingsView:"glob",MoodColors:"mood",SlidersHSV:"hsv",ColorArray:"picker",FlickerWave:"flik"};let r=o;const s=Object.freeze(Object.defineProperty({__proto__:null,RequestDispatcher:r},Symbol.toStringTag,{value:"Module"}));class Unit{get root(){return this._root}get parentUnit(){return this._parU}get domPath(){return Unit.elementDomPath(this._root)}get typeName(){return this.constructor.name}constructor(t){this._root=t}get isVisible(){return"none"!==getComputedStyle(this._root).display}set isVisible(t){this._root.style.display=t?"flex":"none"}show(){this.isVisible=!0}hide(){this.isVisible=!1}reportsTo(t){Assert.Defined(t),this._parU=t}propagateURL(t){const e=`${this.typeName}/${t}`;this.parentUnit?this.parentUnit.propagateURL(e):r.process(e)}dispose(){this.root.remove(),this._parU=null}static Find(t,e){if(!e)throw new Error("selector argument should be a non-empty string");if(!t)throw new Error("root argument was null");const o=t.querySelector(e);if(!o)throw new Error(`root element has no child with selector '${e}'\nroot path:'${Unit.elementDomPath(t)}'`);return o}static FindAll(t,e){if(!e)throw new Error("selector argument should be a non-empty string");if(!t)throw new Error("root argument was null");const o=t.querySelectorAll(e);if(!o||0===o.length)throw new Error(`root element has no children with selector '${e}'\nroot path:'${Unit.elementDomPath(t)}'`);return Array.from(o)}static FindWithTag(t,e){if(!e)throw new Error("tag can't be empty");if(!t)throw new Error("root dom element can't be null");const o=t.querySelector(`[data-tag="${e}"]`);if(!o)throw new Error(`not found in DOM: child with tag '${e}' in parent ${Unit.elementDomPath(t)}`);return o}static elementDomPath(t){const e=[];let o=t;for(;o;)e.push(o.tagName.toLocaleLowerCase()),o=o.parentElement;const r=t.id?` [${t.id}]`:"";return e.reverse().join("/")+r}}const i=Object.freeze(Object.defineProperty({__proto__:null,Unit:Unit},Symbol.toStringTag,{value:"Module"})),n={};function log(t,e=!1){console.log(`${t}`),e&&console.trace()}function logi(t){const e=(new Error(t).stack.split("\n")[2]??"").match(/at\s+([^\s(]+)/),o=e?e[1]:"unknown";console.log(`[${o}]: ${t}`)}function err(t){const e=new Error(t),o=(e.stack.split("\n")[2]??"").match(/at\s+([^\s(]+)/),r=o?o[1]:"unknown";throw e.message=`[${r}] ${t}`,e}class Assert{static True(t,e="Condition was false"){t||err(e)}static False(t,e="Condition was true"){t&&err(e)}static Index(t,e){(e<0||e>=t.length)&&err(`Index out of range: ${t.length}[${e}]`)}static Defined(t){t||err("object was undefined or null")}static IsType(t,e){if(t instanceof e)return;const o=t?.constructor?.name??typeof t;err(`Type mismatch: expected ${e.name}, got ${o}`)}static IsArray(t,e){Array.isArray(t)||err("The object is not an array"),void 0===e?0===t.length&&err("The array is empty"):t.length!==e&&err(`Expected array length ${e}, got ${t.length}`)}}const a=Object.freeze(Object.defineProperty({__proto__:null,Assert:Assert},Symbol.toStringTag,{value:"Module"}));class CompositeUnit extends Unit{constructor(){super(...arguments),this.fields={}}attachClassField(t,e){Assert.True(!!t,"filedName was empty"),Assert.True(!this.fields[t],`duplicate of '${t}'`),this.fields[t]=e,log(`\t\tÂ·${this.typeName}.${t} field added`)}onObjectConstructed(){this.initializeClassFields(),this.initializeEvents()}getField(t){const e=this.fields[t];return Assert.False(!e,`no filed '${this.typeName}.${t}' was found (refactored?) Available: [${Object.keys(this.fields).join(", ")}]`),e}}const l=Object.freeze(Object.defineProperty({__proto__:null,CompositeUnit:CompositeUnit},Symbol.toStringTag,{value:"Module"})),c=class _Time{static update(){const t=performance.now();this.dt=t-this._msPrev/1e3,this.now=t/1e3,this._msPrev=t}};c._msPrev=performance.now(),c.dt=0,c.now=0;let d=c;const u=Object.freeze(Object.defineProperty({__proto__:null,Time:d},Symbol.toStringTag,{value:"Module"})),p=class _Coroutine{static start(t){Assert.Defined(t);const e=null==this.runningSet;e&&(this.runningSet=new Set),this.runningSet.add(new Routine(t)),e&&this.update()}static waitSeconds(t){const e=performance.now()+1e3*t;return new WaitToken(()=>performance.now()>=e)}static waitCondition(t){return new WaitToken(t)}static waitFrames(t){let e=t;return new WaitToken(()=>--e<=0)}};p.update=()=>{if(d.update(),!p.runningSet||0===p.runningSet.size)return void requestAnimationFrame(p.update);const t=[];for(const e of p.runningSet){if(null!=e.token){if(!e.token.isDone)continue;e.token=void 0}const o=e.gen.next();o.value instanceof WaitToken&&!1===o.value.isDone?e.token=o.value:o.done&&t.push(e)}t.forEach(t=>p.runningSet.delete(t)),requestAnimationFrame(p.update)};let _=p;class WaitToken{get isDone(){return this._pred()}constructor(t){this._pred=t}}class Routine{constructor(t){this.gen=t}}const m=Object.freeze(Object.defineProperty({__proto__:null,Coroutine:_,WaitToken:WaitToken},Symbol.toStringTag,{value:"Module"}));class AnimationFX{static sliderLuma(t,e){_.start(this.cr_labelStuff(t,e))}static startHeader(t,e,o){_.start(this.cr_animateHeaderStar(t,e,o))}static*cr_labelStuff(t,e){Assert.Defined(t);const o=Unit.Find(t.root,"label");if(0===o.textContent.length)return;const r=o.textContent.toLowerCase();let s=0;for(;;){const t=r.split(""),i=s++%r.length;t[i]=t[i].toUpperCase(),o.textContent=t.join(""),yield _.waitSeconds(e)}}static*cr_animateHeaderStar(t,e,o){e();const r=t.style.transform;let s=0,i=18;try{for(;i>.5;){const e=Math.sin(1.7*s)*i,o=Math.cos(1.3*s+Math.sin(s))*i*.6,n=6*Math.sin(2.1*s);t.style.transform=`${r} translate(${e}px, ${o}px) rotate(${n}deg)`,i*=.97,s+=.15,yield 0}}finally{t.style.transform=r,o()}}}const h=Object.freeze(Object.defineProperty({__proto__:null,AnimationFX:AnimationFX},Symbol.toStringTag,{value:"Module"}));class ViewsManager extends CompositeUnit{constructor(){super(...arguments),this.isStarAnimated=!1}initializeClassFields(){this.viewsSelect=this.getField("viewsSelect"),this.viewsRoot=this.getField("viewsRoot")}initializeEvents(){this.viewsSelect.callback=t=>this.viewsRoot.activeIdx=t,this.viewsSelect.invokeOnChange(1),this.registerBlazarClick(),this.registerStarClick()}registerBlazarClick(){const t=document.getElementById("ID-span-blazar");Assert.Defined(t);let e=0,o=null;t.addEventListener("click",()=>{e++,null===o&&(o=setTimeout(()=>{e=0,o=null},1e3)),3===e&&(clearTimeout(o),o=null,e=0,this.viewsRoot.activeIdx=3)})}registerStarClick(){const t=document.getElementById("ID-span-star");Assert.Defined(t),t.addEventListener("click",()=>{this.isStarAnimated||AnimationFX.startHeader(t,()=>this.isStarAnimated=!0,()=>this.isStarAnimated=!1)})}}const f=Object.freeze(Object.defineProperty({__proto__:null,ViewsManager:ViewsManager},Symbol.toStringTag,{value:"Module"})),g=class _Application{static getSingleton(t){const e=_Application.rootMap.get(t);if(!e)throw new Error(`Controller of type '${t.name}' not in registry`);return e}static bindKeyAction(t){window.addEventListener("keydown",e=>{e.repeat||t(e.key)})}static async initialize(...t){await async function buildUnitRegistry(){const t=Object.assign({"../../src/BlazarApp.ts":()=>e(()=>Promise.resolve().then(()=>E),void 0),"../../src/anim/AnimationFX.ts":()=>e(()=>Promise.resolve().then(()=>h),void 0),"../../src/forms/ColorArray.ts":()=>e(()=>import("./ColorArray-DdSo_VNh.js"),__vite__mapDeps([0,1])),"../../src/forms/FlickerWave.ts":()=>e(()=>import("./FlickerWave-Blx7cjny.js"),__vite__mapDeps([2,1])),"../../src/forms/MoodColors.ts":()=>e(()=>import("./MoodColors-CzMyuSUP.js"),__vite__mapDeps([3,1])),"../../src/forms/SlidersHSV.ts":()=>e(()=>import("./SlidersHSV-B3y4xx1e.js"),__vite__mapDeps([4,1])),"../../src/inputs/ColorItem.ts":()=>e(()=>import("./ColorItem-Zxn_6MR4.js"),__vite__mapDeps([5,6,7])),"../../src/utils/Color.ts":()=>e(()=>import("./Color-DjessYRo.js"),[]),"../../src/views/DeckView.ts":()=>e(()=>import("./DeckView-C0ZtpVqW.js"),[]),"../../src/views/DevView.ts":()=>e(()=>import("./DevView-CTOP3Lj_.js"),[]),"../../src/views/LampView.ts":()=>e(()=>import("./LampView-Ca5-L7fj.js"),__vite__mapDeps([8,9,1])),"../../src/views/SettingsView.ts":()=>e(()=>import("./SettingsView-eI8zicpF.js"),[]),"../../src/views/ViewsManager.ts":()=>e(()=>Promise.resolve().then(()=>f),void 0),"../../src/vite-env.d.ts":()=>e(()=>Promise.resolve().then(()=>b),void 0),"../containers/CompositeUnit.ts":()=>e(()=>Promise.resolve().then(()=>l),void 0),"../containers/Container.ts":()=>e(()=>import("./Container-CRIcruXa.js"),[]),"../containers/FormUnit.ts":()=>e(()=>import("./FormUnit-C-IcR_K4.js"),[]),"../containers/ViewUnit.ts":()=>e(()=>import("./ViewUnit-uQiRhdNi.js"),__vite__mapDeps([9,1])),"./Assert.ts":()=>e(()=>Promise.resolve().then(()=>a),void 0),"./Time.ts":()=>e(()=>Promise.resolve().then(()=>u),void 0),"./Unit.ts":()=>e(()=>Promise.resolve().then(()=>i),void 0),"./aliases.ts":()=>e(()=>Promise.resolve().then(()=>A),void 0),"../inputs/ButtonsRow.ts":()=>e(()=>import("./ButtonsRow-BmwUqoFJ.js"),__vite__mapDeps([10,6])),"../inputs/ButtonsRowSig.ts":()=>e(()=>import("./ButtonsRowSig-QZSFIG-e.js"),__vite__mapDeps([11,10,6])),"../inputs/Checkbox.ts":()=>e(()=>import("./Checkbox-DgTaWaXC.js"),__vite__mapDeps([12,6])),"../inputs/Dropdown.ts":()=>e(()=>import("./Dropdown-TmdMK-gA.js"),__vite__mapDeps([13,6])),"../inputs/InputUnit.ts":()=>e(()=>import("./InputUnit-DdMMWUWl.js"),[]),"../inputs/Numeral.ts":()=>e(()=>import("./Numeral-3jtf51H9.js"),__vite__mapDeps([14,6])),"../inputs/Slider.ts":()=>e(()=>import("./Slider-B3-yrkMK.js"),__vite__mapDeps([15,6])),"../static/Application.ts":()=>e(()=>Promise.resolve().then(()=>y),void 0),"../static/Coroutine.ts":()=>e(()=>Promise.resolve().then(()=>m),void 0),"../static/RequestDispatcher.ts":()=>e(()=>Promise.resolve().then(()=>s),void 0)}),o=Object.values(t).map(t=>t().then(t=>{for(const e in t){const o=t[e];"function"==typeof o&&(n[o.name]=o)}}));await Promise.all(o),n[Unit.name]=Unit}(),logi(`classes in global registry:\n[${Object.keys(n)}]`),Assert.True(0===this.rootMap.size),Assert.IsArray(t),logi("initializing ..."),this.buildRootUnits(t),this.buildAutoUnits(),logi("... all done")}static cloneUnit(t,e,o){Assert.Defined(t);const r=t.root.cloneNode(!0);o.appendChild(r);const s=new(0,t.constructor)(r);return s.reportsTo(e),this.recursiveBuildUnit(s,s.root,0),s instanceof CompositeUnit&&s.onObjectConstructed(),s}static removeUnit(t){Assert.Defined(t),t.dispose()}static buildRootUnits(t){log("searching of DOM root Unit(s)");for(const e of t){log(`@ ${e.name}`);const t=Array.from(document.querySelectorAll(`[data-roottype="${e.name}"]`));0===t.length&&err(`no [data-roottype=${e.name}] found in DOM`);const o=new e(t[0]);this.rootMap.set(e,o)}Assert.True(this.rootMap.size>0),log(`total ${this.rootMap.size} root Unit object(s)`)}static buildAutoUnits(){log("auto-discovering of Unit(s)");for(const[t,e]of this.rootMap)log(`+ [M]${t.name}`),this.recursiveBuildUnit(e,e.root,0),e instanceof CompositeUnit&&e.onObjectConstructed()}static recursiveBuildUnit(t,e,o){for(const r of Array.from(e.children,t=>t)){const e=r.dataset.type,s=r.dataset.field,i=Unit.elementDomPath(r);if(e){Assert.False(!s,`Dom el. ${i} declared type '${e}' but is missing 'data-field' attribute`);const a=n[e];a||err(`DOM el. ${i} attached type '${e}' that is NOT part of Unit family ctors`),log("    ".repeat(o+1)+`+ ${e}`);const l=new a(r);l.reportsTo(t),this.recursiveBuildUnit(l,r,o+1),l instanceof CompositeUnit&&l.onObjectConstructed(),"none"!==s&&this.findCompositeParent(l).attachClassField(s,l)}else this.recursiveBuildUnit(t,r,o+1)}}static findCompositeParent(t){let e=t.parentUnit;for(;;){if(e||err(`DOM el. ${t.domPath} does not have a parent that is ${CompositeUnit.name}`),e instanceof CompositeUnit)return e;e=e.parentUnit}}};g.rootMap=new Map;let w=g;const y=Object.freeze(Object.defineProperty({__proto__:null,Application:w},Symbol.toStringTag,{value:"Module"}));class BlazarApp extends w{static async Run(){await BlazarApp.initialize(ViewsManager),BlazarApp.bindKeyboard(),this.mainPager=w.getSingleton(ViewsManager)}static bindKeyboard(){w.bindKeyAction(t=>{const e=w.getSingleton(ViewsManager);"t"===t&&(e.isVisible=!e.isVisible)})}}!async function main(){await BlazarApp.Run()}();const E=Object.freeze(Object.defineProperty({__proto__:null,BlazarApp:BlazarApp},Symbol.toStringTag,{value:"Module"})),b=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),A=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{w as A,CompositeUnit as C,Unit as U,AnimationFX as a,Assert as b,log as l};
